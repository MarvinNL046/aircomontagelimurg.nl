<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Webhook Test - GoHighLevel Integration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">GoHighLevel Webhook Test</h1>
        <p class="text-muted">This page tests ONLY the webhook integration (EmailJS is disabled for testing)</p>
        
        <form id="testForm" class="needs-validation" novalidate>
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="name" class="form-label">Naam</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="col-md-6">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="col-md-6">
                    <label for="phone" class="form-label">Telefoon</label>
                    <input type="tel" class="form-control" id="phone" name="phone" required>
                </div>
                <div class="col-md-6">
                    <label for="city" class="form-label">Woonplaats</label>
                    <input type="text" class="form-control" id="city" name="city" required>
                </div>
                <div class="col-12">
                    <label for="message" class="form-label">Bericht</label>
                    <textarea class="form-control" id="message" name="message" rows="3"></textarea>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Test Webhook</span>
                        <span class="btn-loading d-none">
                            <span class="spinner-border spinner-border-sm" role="status"></span>
                            Verzenden...
                        </span>
                    </button>
                </div>
            </div>
        </form>
        
        <div id="alertContainer" class="mt-3"></div>
        
        <div id="responseLog" class="mt-4">
            <h3>Response Log:</h3>
            <pre id="logContent" class="bg-light p-3 rounded"></pre>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://services.leadconnectorhq.com/hooks/k90zUH3RgEQLfj7Yc55b/webhook-trigger/54670718-ea44-43a1-a81a-680ab3d5f67f';
        
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoading = submitBtn.querySelector('.btn-loading');
            const logContent = document.getElementById('logContent');
            const alertContainer = document.getElementById('alertContainer');
            
            // Validate form
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            // Get form data
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // Show loading
            submitBtn.disabled = true;
            btnText.classList.add('d-none');
            btnLoading.classList.remove('d-none');
            
            // Clear previous alerts
            alertContainer.innerHTML = '';
            
            // Prepare webhook data
            const webhookData = {
                data: {
                    name: data.name,
                    email: data.email,
                    phone: data.phone,
                    city: data.city,
                    message: data.message || 'Test message from webhook test page'
                }
            };
            
            // Log request
            logContent.textContent = 'Sending webhook request...\n\n';
            logContent.textContent += 'URL: ' + WEBHOOK_URL + '\n\n';
            logContent.textContent += 'Request Data:\n' + JSON.stringify(webhookData, null, 2) + '\n\n';
            
            try {
                const startTime = Date.now();
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(webhookData)
                });
                
                const responseTime = Date.now() - startTime;
                
                // Log response
                logContent.textContent += `Response Status: ${response.status} ${response.statusText}\n`;
                logContent.textContent += `Response Time: ${responseTime}ms\n\n`;
                
                let responseText = '';
                try {
                    responseText = await response.text();
                    logContent.textContent += 'Response Body:\n' + responseText + '\n';
                } catch (e) {
                    logContent.textContent += 'Could not read response body\n';
                }
                
                if (response.ok) {
                    showAlert('success', 'âœ“ Webhook sent successfully!');
                    form.reset();
                    form.classList.remove('was-validated');
                } else {
                    showAlert('danger', `Webhook failed with status: ${response.status}`);
                }
            } catch (error) {
                logContent.textContent += `Error: ${error.message}\n`;
                showAlert('danger', `Error: ${error.message}`);
            } finally {
                // Reset button
                submitBtn.disabled = false;
                btnText.classList.remove('d-none');
                btnLoading.classList.add('d-none');
            }
        });
        
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alert);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>